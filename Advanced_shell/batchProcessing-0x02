#!/bin/bash

# Create the directory if it doesn't exist
mkdir -p pokemon_data
touch errors.txt

# List of Pokémon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Base URL
base_url="https://pokeapi.co/api/v2/pokemon"

# Loop through each Pokémon
for name in "${pokemon_list[@]}"
do
  echo "Fetching data for $name..."

  # Retry logic
  retries=3
  success=false

  while [ $retries -gt 0 ]; do
    # Fetch data
    curl -s "$base_url/$name" -o "pokemon_data/${name}.json"

    # Validate JSON file by checking if it has a name field
    if jq -e '.name' "pokemon_data/${name}.json" > /dev/null 2>&1; then
      echo "Saved data to pokemon_data/${name}.json ✅"
      success=true
      break
    else
      echo "❌ Failed to fetch $name, retrying..."
      ((retries--))
      sleep 1  # Small delay before retry
    fi
  done

  if [ "$success" = false ]; then
    echo "❌ Giving up on $name after 3 failed attempts" | tee -a errors.txt
    rm -f "pokemon_data/${name}.json"  # Clean up invalid file
  fi
done
